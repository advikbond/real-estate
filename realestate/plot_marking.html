<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plot Marking - Real Estate Website</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            overflow-y: auto;
            max-height: 100vh;
        }
        
        .responsive-container {
            overflow-y: auto;
            max-height: calc(100vh - 200px);
            padding-bottom: 20px;
        }
        
        /* Responsive styles for mobile devices */
        @media screen and (max-width: 768px) {
            .responsive-container {
                width: 90% !important;
                max-width: 342px;
                margin-left: auto !important;
                margin-right: auto !important;
            }
            
            .responsive-text {
                font-size: 18px !important;
            }
            
            .responsive-button {
                width: 120px !important;
                height: 45px !important;
                font-size: 18px !important;
            }
            
            .responsive-icon {
                width: 48px !important;
                height: 48px !important;
            }
            
            .responsive-upload-container {
                height: 180px !important;
            }
            
            .responsive-header-text {
                font-size: 18px !important;
                height: 45px !important;
            }
        }
        
        @media screen and (max-width: 480px) {
            .responsive-container {
                width: 95% !important;
            }
            
            .responsive-text {
                font-size: 16px !important;
            }
            
            .responsive-button {
                width: 100px !important;
                height: 40px !important;
                font-size: 16px !important;
            }
            
            .responsive-icon {
                width: 40px !important;
                height: 40px !important;
            }
            
            .responsive-upload-container {
                height: 160px !important;
            }
            
            .responsive-header-text {
                font-size: 16px !important;
                height: 40px !important;
            }
        }
        
        @media screen and (max-width: 360px) {
            .responsive-container {
                width: 98% !important;
            }
            
            .responsive-text {
                font-size: 14px !important;
            }
            
            .responsive-button {
                width: 90px !important;
                height: 35px !important;
                font-size: 14px !important;
            }
            
            .responsive-icon {
                width: 36px !important;
                height: 36px !important;
            }
            
            .responsive-upload-container {
                height: 140px !important;
            }
            
            .responsive-header-text {
                font-size: 14px !important;
                height: 35px !important;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36" fill="none">
                <path d="M16.997 9.75035L22.2859 8.02875L18.809 13.0927L17.04 15.6691L8.69576 27.8222C8.2351 28.4931 8.35053 29.4725 8.96539 30.11L11.841 33.0911C12.3286 33.5967 13.026 33.7741 13.6158 33.5425L25.7764 28.768C26.6644 28.4193 26.9885 27.2913 26.4681 26.3603L21.7228 17.87L20.2174 20.021L22.9533 26.1238L12.998 30.3368L20.2174 20.021L21.7228 17.87L26.6229 10.8683C27.0886 10.2028 26.9817 9.22465 26.373 8.58213L21.3458 3.27564C20.8234 2.72417 20.0576 2.55747 19.4454 2.86197L14.0825 5.52975C13.325 5.90656 13.038 6.8794 13.4302 7.74089L17.04 15.6691L18.809 13.0927L16.997 9.75035Z" fill="url(#paint0_linear_2_359)"/>
                <defs>
                    <linearGradient id="paint0_linear_2_359" x1="12.8601" y1="5.72792" x2="22.5551" y2="30.4205" gradientUnits="userSpaceOnUse">
                        <stop stop-color="white"/>
                        <stop offset="0.701923" stop-color="#F6F6F6"/>
                        <stop offset="1" stop-color="#999999"/>
                    </linearGradient>
                </defs>
            </svg>
        </div>
        <div class="hamburger-menu" onclick="toggleMenu()">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <div class="hamburger-dropdown" id="hamburgerDropdown">
                <button class="logout-button" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </header>
    
    <div class="next-page-container">
    </div>
    
    <button class="back-button" onclick="goBackToLayoutPhoto()">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="none">
            <circle cx="16" cy="16" r="14.5" stroke="white" stroke-width="2"/>
        </svg>
        <span class="back-button-text">‚Üê</span>
    </button>
    
    <div class="responsive-container responsive-header-text" style="margin-top: 65px; height: 50px; flex-shrink: 0; border-radius: 15px; background: #FFF; color: #000; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal; display: flex; align-items: center; justify-content: center;">
        Site Layout
    </div>
    
    <div id="upload-container" class="responsive-container responsive-upload-container" style="margin-top: 20px; height: 200px; flex-shrink: 0; border-radius: 15px; background: #FFF; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden;">
        <div id="upload-placeholder" style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <svg class="responsive-icon" xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64" fill="none">
                <path d="M54 16.25H45.5L43.475 10.575C43.3351 10.1867 43.0787 9.85101 42.7409 9.61386C42.4031 9.37671 42.0003 9.24964 41.5875 9.25H22.4125C21.5688 9.25 20.8125 9.78125 20.5312 10.575L18.5 16.25H10C7.2375 16.25 5 18.4875 5 21.25V49.75C5 52.5125 7.2375 54.75 10 54.75H54C56.7625 54.75 59 52.5125 59 49.75V21.25C59 18.4875 56.7625 16.25 54 16.25ZM32 44.75C26.475 44.75 22 40.275 22 34.75C22 29.225 26.475 24.75 32 24.75C37.525 24.75 42 29.225 42 34.75C42 40.275 37.525 44.75 32 44.75ZM26 34.75C26 36.3413 26.6321 37.8674 27.7574 38.9926C28.8826 40.1179 30.4087 40.75 32 40.75C33.5913 40.75 35.1174 40.1179 36.2426 38.9926C37.3679 37.8674 38 36.3413 38 34.75C38 33.1587 37.3679 31.6326 36.2426 30.5074C35.1174 29.3821 33.5913 28.75 32 28.75C30.4087 28.75 28.8826 29.3821 27.7574 30.5074C26.6321 31.6326 26 33.1587 26 34.75Z" fill="#1A1A1A"/>
            </svg>
            <span class="responsive-text" style="margin-top: 10px; color: #000; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal;">UPLOAD LAYOUT</span>
        </div>
        
        <!-- Photo Preview with Plots -->
        <div id="photo-preview" style="display: none; width: 100%; height: 100%; position: relative; cursor: grab; overflow: hidden;">
            <div id="image-container" style="position: relative; overflow: hidden;">
                <img id="uploaded-photo" style="width: 100%; height: 100%; object-fit: contain;" alt="Uploaded layout">
                <canvas id="plot-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></canvas>
            </div>
        </div>
    </div>
    
    
    <div class="responsive-container" style="margin-top: 20px; display: flex; justify-content: center; align-items: center;">
        <button style="width: 32px; height: 32px; flex-shrink: 0; border-radius: 32px; background: #FF5E00; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="14" viewBox="0 0 23 14" fill="none" style="transform: translateY(-2px);">
                <path d="M18.6309 5.40137L22.2305 13.5H0.685547L4.81934 0.638672L18.6309 5.40137Z" stroke="#F6F6F6" stroke-width="1px"/>
            </svg>
        </button>
    </div>
    
    <div class="responsive-container" style="margin-top: 20px; width: 348px; height: 564px; flex-shrink: 0; border-radius: 15px; background: #2E2E2E; position: relative;">
        <div id="plot-details-title" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); color: #FFF; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal;">
            Plot Details
        </div>
        
        <!-- Plot Numbers Section -->
        <div id="plot-numbers-section" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-width: 320px;">
            <!-- Plot numbers will be dynamically generated here -->
        </div>
        
        <div style="position: absolute; top: 90px; left: 6px; color: #FFF; font-family: Monaco; font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
            Plot Number
        </div>
        
        <div style="position: absolute; top: 119px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="text" id="plot-number-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter plot number..." readonly>
        </div>
        
        <div style="position: absolute; top: 174px; left: 6px; color: #FFF; font-family: Monaco; font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
            Owner's Name
        </div>
        
        <div style="position: absolute; top: 203px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="text" id="owner-name-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter owner's name...">
        </div>
        
        <div style="position: absolute; top: 258px; left: 6px; color: #FFF; font-family: Monaco; font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
            Plot Status
        </div>
        
        <div style="position: absolute; top: 287px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="text" id="plot-status-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter plot status...">
        </div>
        
        <div style="position: absolute; top: 342px; left: 6px; color: #FFF; font-family: Monaco; font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
            Contact Information
        </div>
        
        <div style="position: absolute; top: 371px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="tel" id="phone-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter phone number...">
        </div>
        
        <div style="position: absolute; top: 426px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="email" id="email-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter email address...">
        </div>
        
        <div style="position: absolute; top: 481px; left: 6px; color: #FFF; font-family: Monaco; font-size: 14px; font-style: normal; font-weight: 400; line-height: normal;">
            Notes
        </div>
        
        <div style="position: absolute; top: 510px; left: 6px; width: 328px; height: 45px; flex-shrink: 0; border-radius: 15px; background: #FFF;">
            <input type="text" id="notes-input" style="width: 100%; height: 100%; border: none; outline: none; background: transparent; font-family: Monaco; font-size: 16px; color: #000; padding: 0 15px; border-radius: 15px;" placeholder="Enter notes...">
        </div>
    </div>
    
    <div class="responsive-container" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
        <button class="responsive-button" style="height: 50px; flex-shrink: 0; border-radius: 15px; background: #FFF; color: #000; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal; border: none; cursor: pointer;" onclick="goBackToLayoutPhoto()">Back</button>
        <button class="responsive-button" style="height: 50px; flex-shrink: 0; border-radius: 15px; background: #666; color: #FFF; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal; border: none; cursor: pointer;" onclick="savePlotDetails()">Save</button>
        <button class="responsive-button" style="height: 50px; flex-shrink: 0; border-radius: 15px; background: #FF5E00; color: #FFF; font-family: Monaco; font-size: 20px; font-style: normal; font-weight: 400; line-height: normal; border: none; cursor: pointer;" onclick="goToNewProject()">Next</button>
    </div>
    
    <main class="main-content">
        <!-- Main content will go here -->
    </main>
    
    <script>
        let plots = [];
        let currentPlotIndex = -1;
        let plotDetails = {}; // Store details for each plot
        
        // Panning variables
        let isPanning = false;
        let lastPanX = 0;
        let lastPanY = 0;
        let translateX = 0;
        let translateY = 0;
        let scale = 1;

        // Load plot data when page loads
        window.onload = function() {
            loadPlotData();
            generatePlotNumbers();
            
            // Initialize save button as disabled
            const saveButton = document.querySelector('button[onclick="savePlotDetails()"]');
            saveButton.style.background = '#666';
            saveButton.disabled = true;
        };

        function loadPlotData() {
            // Load plot data from localStorage
            const savedPlotData = localStorage.getItem('plotMarkingData');
            console.log('Saved plot data from localStorage:', savedPlotData);
            
            if (savedPlotData) {
                const data = JSON.parse(savedPlotData);
                plots = data.plots || [];
                console.log('Loaded plots:', plots);
                console.log('Image data available:', !!data.imageData);
                
                // Load and display the uploaded image with plots
                loadAndDisplayImage(data.imageData);
            } else {
                console.log('No plot data found in localStorage');
            }
            
            // Load plot details if they exist
            const savedDetails = localStorage.getItem('plotDetails');
            if (savedDetails) {
                plotDetails = JSON.parse(savedDetails);
            }
        }

        function loadAndDisplayImage(imageData) {
            console.log('loadAndDisplayImage called with:', !!imageData, 'plots length:', plots.length);
            
            if (imageData) {
                console.log('Loading image');
                const img = document.getElementById('uploaded-photo');
                img.src = imageData;
                
                // Hide placeholder and show photo
                document.getElementById('upload-placeholder').style.display = 'none';
                document.getElementById('photo-preview').style.display = 'block';
                
                // Wait for image to load, then draw plots
                img.onload = function() {
                    console.log('Image loaded, initializing canvas and drawing plots');
                    initializeCanvas();
                    initializePanning();
                    if (plots.length > 0) {
                        drawPlotsOnCanvas();
                    }
                };
                
                console.log('Image and plots should be displayed now');
            } else {
                console.log('Cannot display image - missing imageData');
                // Show message that image couldn't be loaded
                document.getElementById('upload-placeholder').innerHTML = `
                    <div style="text-align: center; color: #666;">
                        <p>Image too large to display</p>
                        <p style="font-size: 12px;">Please use a smaller image file</p>
                    </div>
                `;
            }
        }

        function initializeCanvas() {
            const canvas = document.getElementById('plot-canvas');
            const ctx = canvas.getContext('2d');
            const container = document.getElementById('upload-container');
            const img = document.getElementById('uploaded-photo');
            
            // Wait for image to load to get its natural dimensions
            if (img.complete) {
                setupCanvasWithImage();
            } else {
                img.onload = setupCanvasWithImage;
            }
            
            function setupCanvasWithImage() {
                const containerWidth = container.offsetWidth;
                const containerHeight = container.offsetHeight;
                const imgWidth = img.naturalWidth;
                const imgHeight = img.naturalHeight;
                
                // Calculate the actual displayed image dimensions (with object-fit: contain)
                const containerAspect = containerWidth / containerHeight;
                const imgAspect = imgWidth / imgHeight;
                
                let displayWidth, displayHeight, offsetX, offsetY;
                
                if (imgAspect > containerAspect) {
                    // Image is wider than container - fit to width
                    displayWidth = containerWidth;
                    displayHeight = containerWidth / imgAspect;
                    offsetX = 0;
                    offsetY = (containerHeight - displayHeight) / 2;
                } else {
                    // Image is taller than container - fit to height
                    displayHeight = containerHeight;
                    displayWidth = containerHeight * imgAspect;
                    offsetX = (containerWidth - displayWidth) / 2;
                    offsetY = 0;
                }
                
                // Set canvas size to match the actual displayed image area
                canvas.width = displayWidth;
                canvas.height = displayHeight;
                canvas.style.left = offsetX + 'px';
                canvas.style.top = offsetY + 'px';
                canvas.style.width = displayWidth + 'px';
                canvas.style.height = displayHeight + 'px';
                
                // Store scaling factors for plot coordinate conversion
                window.imageScaleX = displayWidth / imgWidth;
                window.imageScaleY = displayHeight / imgHeight;
                window.imageOffsetX = offsetX;
                window.imageOffsetY = offsetY;
                
                console.log('Canvas setup:', {
                    containerSize: { width: containerWidth, height: containerHeight },
                    imageSize: { width: imgWidth, height: imgHeight },
                    displaySize: { width: displayWidth, height: displayHeight },
                    offset: { x: offsetX, y: offsetY },
                    scale: { x: window.imageScaleX, y: window.imageScaleY }
                });
            }
        }

        function initializePanning() {
            const photoPreview = document.getElementById('photo-preview');
            const imageContainer = document.getElementById('image-container');
            
            // Mouse events
            photoPreview.addEventListener('mousedown', handlePanStart);
            photoPreview.addEventListener('mousemove', handlePanMove);
            photoPreview.addEventListener('mouseup', handlePanEnd);
            photoPreview.addEventListener('mouseleave', handlePanEnd);
            
            // Touch events for mobile
            photoPreview.addEventListener('touchstart', handleTouchStart, { passive: false });
            photoPreview.addEventListener('touchmove', handleTouchMove, { passive: false });
            photoPreview.addEventListener('touchend', handleTouchEnd, { passive: false });
        }

        function handlePanStart(e) {
            e.preventDefault();
            isPanning = true;
            lastPanX = e.clientX;
            lastPanY = e.clientY;
            document.getElementById('photo-preview').style.cursor = 'grabbing';
        }

        function handlePanMove(e) {
            if (!isPanning) return;
            
            e.preventDefault();
            const currentX = e.clientX;
            const currentY = e.clientY;
            
            const deltaX = currentX - lastPanX;
            const deltaY = currentY - lastPanY;
            
            translateX += deltaX;
            translateY += deltaY;
            
            lastPanX = currentX;
            lastPanY = currentY;
            
            updateImageTransform();
            drawPlotsOnCanvas(); // Redraw plots with new transform
        }

        function handlePanEnd(e) {
            if (!isPanning) return;
            
            isPanning = false;
            document.getElementById('photo-preview').style.cursor = 'grab';
        }

        function handleTouchStart(e) {
            e.preventDefault();
            if (e.touches.length === 1) {
                isPanning = true;
                lastPanX = e.touches[0].clientX;
                lastPanY = e.touches[0].clientY;
            }
        }

        function handleTouchMove(e) {
            if (!isPanning || e.touches.length !== 1) return;
            
            e.preventDefault();
            const currentX = e.touches[0].clientX;
            const currentY = e.touches[0].clientY;
            
            const deltaX = currentX - lastPanX;
            const deltaY = currentY - lastPanY;
            
            translateX += deltaX;
            translateY += deltaY;
            
            lastPanX = currentX;
            lastPanY = currentY;
            
            updateImageTransform();
            drawPlotsOnCanvas(); // Redraw plots with new transform
        }

        function handleTouchEnd(e) {
            if (e.touches.length === 0) {
                isPanning = false;
            }
        }

        function updateImageTransform() {
            const img = document.getElementById('uploaded-photo');
            img.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        function drawPlotsOnCanvas() {
            const canvas = document.getElementById('plot-canvas');
            const ctx = canvas.getContext('2d');
            
            console.log('Drawing plots on canvas. Canvas size:', canvas.width, 'x', canvas.height);
            console.log('Number of plots to draw:', plots.length);
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw each plot with proper scaling and panning
            plots.forEach((plot, index) => {
                console.log(`Drawing plot ${index + 1}:`, plot);
                
                // Convert plot coordinates from original image to displayed image
                const scaledX = plot.x * window.imageScaleX;
                const scaledY = plot.y * window.imageScaleY;
                const scaledWidth = plot.width * window.imageScaleX;
                const scaledHeight = plot.height * window.imageScaleY;
                
                // Apply panning transform
                const transformedX = scaledX + translateX;
                const transformedY = scaledY + translateY;
                
                // Draw rectangle
                ctx.strokeStyle = '#FF5E00';
                ctx.lineWidth = 2;
                ctx.setLineDash([]);
                ctx.strokeRect(
                    transformedX,
                    transformedY,
                    scaledWidth,
                    scaledHeight
                );
                
                // Draw number
                ctx.fillStyle = '#FF5E00';
                ctx.font = '16px Monaco';
                ctx.textAlign = 'center';
                ctx.fillText(
                    plot.number.toString(),
                    transformedX + scaledWidth / 2,
                    transformedY + scaledHeight / 2 + 6
                );
            });
            
            console.log('Finished drawing plots');
        }

        function generatePlotNumbers() {
            const plotNumbersSection = document.getElementById('plot-numbers-section');
            plotNumbersSection.innerHTML = '';
            
            if (plots.length === 0) {
                plotNumbersSection.innerHTML = '<div style="color: #FFF; font-family: Monaco; font-size: 14px;">No plots found. Please go back and create plots first.</div>';
                return;
            }
            
            // Create plot number buttons
            plots.forEach((plot, index) => {
                const plotButton = document.createElement('div');
                plotButton.style.cssText = `
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background: #FF5E00;
                    color: #FFF;
                    font-family: Monaco;
                    font-size: 16px;
                    font-weight: 400;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    border: 2px solid transparent;
                `;
                plotButton.textContent = plot.number;
                plotButton.onclick = () => selectPlot(index);
                plotNumbersSection.appendChild(plotButton);
            });
        }

        function selectPlot(index) {
            currentPlotIndex = index;
            const plot = plots[index];
            
            // Update plot details title
            document.getElementById('plot-details-title').textContent = `Plot ${plot.number} Details`;
            
            // Update plot number input
            document.getElementById('plot-number-input').value = plot.number;
            
            // Load existing details if available
            const details = plotDetails[plot.number] || {};
            document.getElementById('owner-name-input').value = details.ownerName || '';
            document.getElementById('plot-status-input').value = details.plotStatus || '';
            document.getElementById('phone-input').value = details.phone || '';
            document.getElementById('email-input').value = details.email || '';
            document.getElementById('notes-input').value = details.notes || '';
            
            // Update button styles
            const plotButtons = document.querySelectorAll('#plot-numbers-section > div');
            plotButtons.forEach((btn, i) => {
                if (i === index) {
                    btn.style.background = '#FFF';
                    btn.style.color = '#FF5E00';
                    btn.style.border = '2px solid #FF5E00';
                } else {
                    btn.style.background = '#FF5E00';
                    btn.style.color = '#FFF';
                    btn.style.border = '2px solid transparent';
                }
            });
            
            // Enable save button
            const saveButton = document.querySelector('button[onclick="savePlotDetails()"]');
            saveButton.style.background = '#FF5E00';
            saveButton.disabled = false;
        }

        function savePlotDetails() {
            if (currentPlotIndex === -1) {
                alert('Please select a plot first');
                return;
            }
            
            const plot = plots[currentPlotIndex];
            const details = {
                ownerName: document.getElementById('owner-name-input').value,
                plotStatus: document.getElementById('plot-status-input').value,
                phone: document.getElementById('phone-input').value,
                email: document.getElementById('email-input').value,
                notes: document.getElementById('notes-input').value
            };
            
            plotDetails[plot.number] = details;
            localStorage.setItem('plotDetails', JSON.stringify(plotDetails));
            
            // Update save button to show saved state
            const saveButton = document.querySelector('button[onclick="savePlotDetails()"]');
            saveButton.textContent = 'Saved!';
            saveButton.style.background = '#4CAF50';
            
            setTimeout(() => {
                saveButton.textContent = 'Save';
                saveButton.style.background = '#666';
            }, 2000);
        }

        function goBackToLayoutPhoto() {
            window.location.href = 'layout_photo.html';
        }
        
        
        function goToNewProject() {
            // Save current plot details before navigating
            if (currentPlotIndex !== -1) {
                savePlotDetails();
            }
            
            // Save project completion status
            localStorage.setItem('projectCompleted', 'true');
            
            window.location.href = 'index.html';
        }

        function toggleMenu() {
            const dropdown = document.getElementById('hamburgerDropdown');
            dropdown.classList.toggle('show');
        }

        function handleLogout() {
            // Navigate to login page when logout is clicked
            window.location.href = 'login.html';
        }

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            const dropdown = document.getElementById('hamburgerDropdown');
            const hamburger = document.querySelector('.hamburger-menu');
            if (!hamburger.contains(event.target)) {
                dropdown.classList.remove('show');
            }
        }
    </script>
</body>
</html>
